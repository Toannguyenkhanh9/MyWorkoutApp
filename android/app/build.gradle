plugins {
  id("com.android.application")
  id("org.jetbrains.kotlin.android")
  id("com.facebook.react")
}

def hermesEnabled = (project.ext.has("hermesEnabled") ? project.ext.hermesEnabled : true)

react { autolinkLibrariesWithApp() }

def enableProguardInReleaseBuilds = false
def jscFlavor = 'io.github.react-native-community:jsc-android:2026004.+'

android {
  namespace "com.myworkoutapp"

  // Lấy cấu hình từ gradle.properties (không phụ thuộc rootProject.ext nữa)
  def _compile = (findProperty('ANDROID_COMPILE_SDK_VERSION') ?: "36") as Integer
  def _buildTl =  (findProperty('ANDROID_BUILD_TOOLS_VERSION') ?: "36.0.0")
  def _ndk     =  (findProperty('ANDROID_NDK_VERSION') ?: "27.1.12297006")
  def _min     = (findProperty('ANDROID_MIN_SDK_VERSION') ?: "24") as Integer
  def _target  = (findProperty('ANDROID_TARGET_SDK_VERSION') ?: "36") as Integer

  compileSdk _compile
  buildToolsVersion _buildTl
  ndkVersion _ndk

  defaultConfig {
    applicationId "com.myworkoutapp"
    minSdkVersion _min
    targetSdkVersion _target
    versionCode 1
    versionName "1.0"

    manifestPlaceholders = [
      googleMobileAdsAppId : "ca-app-pub-7270703936050310~4564431234",
      usesCleartextTraffic : false
    ]
  }

  signingConfigs {
    debug {
      storeFile file('debug.keystore')
      storePassword 'android'
      keyAlias 'androiddebugkey'
      keyPassword 'android'
    }
  }

  buildTypes {
    debug { signingConfig signingConfigs.debug }
    release {
      signingConfig signingConfigs.debug
      minifyEnabled enableProguardInReleaseBuilds
      proguardFiles getDefaultProguardFile("proguard-android.txt"), "proguard-rules.pro"
    }
  }
}

dependencies {
  implementation("com.facebook.react:react-android")
  if (hermesEnabled.toBoolean()) {
    implementation("com.facebook.react:hermes-android")
  } else {
    implementation jscFlavor
  }
}
